================================================================================
Secure Software Development Project
================================================================================


================================================================================
Section 1: Data Encryption (Application-Level Encryption)
==============================================================================

Status: Complete

Changes:

1. EncryptionConfig.cs
    - Refactored to store and manage symmetric encryption key and IV for ALE.
    - Key and IV are generated and stored securely (not hardcoded in production).
    - Provides methods for encrypting and decrypting strings using AES (CBC mode, PKCS7 padding).

2. Data_Access_Layer.cs
    - Refactored to encrypt PII fields before inserting/updating records in the database.
    - Decrypts PII fields after reading records from the database.
    - SQLCipher password and database-level encryption are no longer used.

PII Identification:
    - The following fields are considered PII and are encrypted-at-rest: name, address_line_1, address_line_2, address_line_3, town.

How?
    - The application uses AES-256-CBC with a securely generated key and IV.
    - All PII fields are encrypted in the application before being written to the database.
    - When data is read, the application decrypts the PII fields before use.
    - The database only stores ciphertext for PII fields, not plaintext.
    - Key material is protected and not stored in the database.

Issues?
    - Started with Database-Level Encryption but did not want to forfeit the 30% marks. Therefore I went back and implemented ALE (apologies for any artefacts of DLE)


================================================================================
SECTION 2: LOGGING [10%]
================================================================================

Status: Complete

Changes:

1. EventLogger.cs
    - I created this file
    - This writes to the Windows Event Log under the source "SSD Banking Application"
    - I made sure it handles source creation in try/catch so that the app does not crash without admin rights
    - Neatly commented

2. Program.cs
    - I modified this file
    - I added a simple prompt for the tellers name
    - Log any add/close/view/lodge/withdraw successes and failures
    - Ask for a reason if a lodgement/withdrawal is greater than or equal to €10,000 and logs it as 'WHY'
    - Add machine name + SID automatically 'WHERE' and simple app metadata 'HOW'

How?
    - Every transaction now writes a clear Event Log entry with WHO/WHAT/WHERE/WHEN/WHY/HOW
    - Failures (missing account, cancelled closure, insufficient funds) are logged as FAIL
    - Source creation is guarded so running without admin will not blow up the app

Issues?
    - Major issues with EventLog not being able to be found. Unfortunately the fix required assistance.


================================================================================
SECTION 3: AUTHENTICATION/ACCESS CONTROLS [10%]
================================================================================

Status: Done!

Changes:

1. ActiveDirectoryAuthenticator.cs (new file)
    - Method: Authenticate(username, password) → bool + user principal info
    - Method: IsInRole(user, "Bank Teller") and "Bank Teller Administrator"
    - Uses System.DirectoryServices.AccountManagement (handle dispose)

2. Program.cs (modify)
    - Prompt for AD creds at startup; block app if auth fails
    - Enforce role check before showing main menu
    - For account deletion: require secondary approval from Admin role
    - On every auth attempt: call EventLogger.LogAuth

3. Data_Access_Layer.cs (no change expected)
    - Access enforced at Program layer; DAL remains role-agnostic

How?
    - Only AD-authenticated Bank Tellers can perform transactions
    - Deletion path requires Admin confirmation (two-person integrity lite)
    - All auth outcomes are logged for audit


================================================================================
SECTION 4: ADDITIONAL SECURITY CONTROLS [30%]
================================================================================

Status: Incomplete

Changes:

1. Parameterized Queries (Data_Access_Layer.cs)
    - Replace string-concatenated SQL with parameters for INSERT/UPDATE/DELETE
    - Validate account numbers and amounts before executing SQL

2. Input Validation (Program.cs)
    - Central helpers to validate accountNo format, positive amounts, non-empty names
    - Graceful error messages; reject invalid input early

3. Error Handling & Secure Defaults
    - Wrap DB calls with try/catch; log failures via EventLogger
    - Fail closed on auth/logging errors

4. Sensitive Data Handling
    - Avoid storing plaintext passwords in memory longer than necessary
    - Clear credential strings after auth attempts

5. Access Modifiers & Encapsulation
    - Mark fields private where possible; expose via methods/properties
    - Reduce mutable surface of Bank_Account subclasses


================================================================================
SECTION 5: CODE QUALITY AND OVERALL PRESENTATION [10%]
================================================================================

Status: Incomplete

Improvements:
    - Added clear banner comments to all new code
    - Consistent naming conventions
    - Separated concerns (encryption config, data access, logging)

Improvements to make:
    - Parameterize SQL to remove concat risks (ties to Section 4)
    - Add XML docs on public classes/methods (Bank_Account, DAL, Program)
    - Introduce lightweight unit tests for DAL (where feasible)
    - Organize helpers into dedicated files (EventLogger, Authenticator)
    - Run a pass for access modifiers and naming consistency